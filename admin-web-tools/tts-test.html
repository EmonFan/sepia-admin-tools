 <head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
</head> 
<style>
.layer_box2{
	height: 20px;
}
.menu_img{
	max-height: 60px;
}
</style>
<div style="width:400px; height:600px; border: 1px solid black; text-align: center;" id="display_box" class="layer_comp"><!--

	--><!-- LOGIN --->
	<p>KEY: <input id="KEY" placeholder="gig1053;..."></p>
	
	<!--Language Buttons--><!--
	--><div class=layer_section>Languages</div><!--
	--><div class=menu_language_box>
			<button class="menu_flag" onclick="set_language('en')">
				<img id="flag_en" class="menu_img" src="https://files.gigaaa.net/images/flags/flag_uk.png" alt="EN">
			</button>
			<button class="menu_flag" onclick="set_language('de')">
				<img id="flag_de" class="menu_img" src="https://files.gigaaa.net/images/flags/flag_de.png" alt="DE">
			</button>
	</div>
	<br>
	
	<!-- Voice Config -->
	<div class=layer_section>Text-To-Speech Settings</div><br>
	<span class="layer_label1">Play on: </span><!--
	--><select id="playOn_select" class="layer_box1" name="play_on"> 
		<option value="client">Client</option> 
		<option value="server">Server</option>
	</select><br>
	<span class="layer_label1">Sound: </span><!--
	--><select id="sound_select" class="layer_box1" name="sound_out"> 
		<option value="on">On</option> 
		<option value="off">Off</option>
	</select><br>
	<br>
	<span class="layer_label1">Format: </span><!--
	--><select id="sound_format_select" class="layer_box1" name="sound_format"> 
		<option value="default">Default</option>
		<option value="OGG">OGG</option>
		<option value="MP3">MP3_high</option>
		<option value="MP3_CBR_32">MP3_low</option>
		<option value="WAV">WAV</option>
	</select><br>
	<span class="layer_label1">Voice: </span><!--
	--><select id="voice_select" class="layer_box1" name="voices"> 
		<option value="default">Default</option> 
		<option value="julia_de">Julia DE</option>
		<option value="lea_de">Lea (Child) DE</option> 
		<option value="sharon_en">Sharon EN</option>
		<option value="ella_en">Ella (Child) EN</option> 
		<option value="littlecreature_en">Little Creature EN</option> 
		<option value="oldman_en">Old Man EN</option> 
	</select><br>
	<span class="layer_label1">Voice Type: </span><!--
	--><select id="voice_gender_select" class="layer_box1" name="voice_genders"> 
		<option value="default">Default</option> 
		<option value="male">Male</option>
		<option value="female">Female</option> 
		<option value="child">Child</option>
		<option value="old">Old</option> 
		<option value="creature">Creature</option> 
	</select><br>
	<span class="layer_label2">Voice Speed: </span><textarea id="voice_speed" class="layer_box2" style="font-size: 100%">1.00</textarea><br>
	<span class="layer_label2">Voice Tone: </span><textarea id="voice_tone" class="layer_box2" style="font-size: 100%">1.00</textarea><br>
	<br>
	
	<!-- TTS/ASR.. Config --><!--
	--><div class=layer_section>Speech-To-Text</div>
	<span class="layer_label1">Mic. activation: </span><!--
	--><select id="mic_select" class="layer_box1" name="stt" > <!-- this one is supposed to handle if the app automatically activates the microphone on a server "question" -->
		<option value="manual">Manually</option>
		<option value="on_question">On Question</option>
	</select><br>
	<br>
	
	<!-- Server Config --><!--
	--><div class=layer_section>Server</div>
	<span class="layer_label1">Server location: </span><!--
	--><select id="server_select" class="layer_box1" name="servers" > 
		<option value="https://api-eu.gigaaa.link/">Live-Server</option>
		<option value="http://localhost:7971/">Local-Server</option>
	</select><br>
	<br>
	
	<input id="text" placeholder="your text ..."><br>
	<button onclick="send()">SPEAK</button><br>
	<br>
	<audio id="voiceout" controls="true"></audio>
	
</div>

<script>
var language = "de";
var mood = 6;
var environment = "web_app";
var client_info = "web_app_v1.0";
var key = "";
var server = "https://api-eu.gigaaa.link/";

//states
var gigaaa = new Object();
gigaaa.isSpeaking = false;
gigaaa_audio_onEnd_fired = false;

//set language
function set_language(lang){
	language = lang;
}

function send(){
	var msg = document.getElementById("text").value;
	key = document.getElementById("KEY").value;
	server = server_select.options[server_select.selectedIndex].value;
	if (msg){
		get_audio(msg);
	}
}

function play(audioURL){
	var audio = document.getElementById("voiceout");
	audio.src = audioURL;
	audio.preload = 'auto';
	audio.oncanplay = function() {
		console.log("audio can be played (oncanplay event)");		//debug
		gigaaa.isSpeaking = true;
		//gigaaa.avatarStartTalk();  //<---- set "talk animation"
	};
	audio.onpause = function() {
		if (!gigaaa_audio_onEnd_fired){ 	//<-- the onEnd onPause are buggy to we need to fire both for cross-browser support but make sure there is only one executed
			console.log("audio ended (onpause event)");				//debug
			gigaaa_audio_onEnd_fired = true;
			//gigaaa.avatarStartIdle();		 //<---- set "idle animation"
			gigaaa.isSpeaking = false;
			//on audio end call
			//gigaaa.onSpeakEnd();			//<----- add any callbacks here that were sheduled for "after TTS do this ..."
		}
	};
	audio.onended = function() {
		if (!gigaaa_audio_onEnd_fired){
			console.log("audio ended (onend event)");				//debug
			audio.pause();
		}
	};
	audio.onerror = function() {
		console.log("audio error occured!");						//debug
		//$('#htmlInfo').append("<br>audio error: " + audio.error.code + "<br>url: " + audioURL);					//debug
		//gigaaa.avatarStartIdle();		 //<---- set "idle animation"
		gigaaa.isSpeaking = false;
	};
	audio.play();
}

//get audio URL
function get_audio(message){
	//check voice configuration
	var voice_select = document.getElementById("voice_select");
	var voice = voice_select.options[voice_select.selectedIndex].value;
	var gender = voice_gender_select.options[voice_gender_select.selectedIndex].value;
	var voice_speed = document.getElementById("voice_speed").value;
	var voice_tone = document.getElementById("voice_tone").value;
	//check play on server 
	var playOn = playOn_select.options[playOn_select.selectedIndex].value;
	voice_sound_format = sound_format_select.options[sound_format_select.selectedIndex].value;
	var sound_format = voice_sound_format;
	
	var url = server + "tts?text=" + encodeURIComponent(message) + "&KEY=" + key +
						"&lang=" + encodeURIComponent(language) +
						"&mood=" + encodeURIComponent(mood) +
						"&voice=" + encodeURIComponent(voice) +
						"&gender=" + encodeURIComponent(gender) +
						"&speed=" + encodeURIComponent(voice_speed) +
						"&tone=" + encodeURIComponent(voice_tone) +
						"&env=" + encodeURIComponent(environment) +
						"&playOn=" + encodeURIComponent(playOn) +
						"&format=" + encodeURIComponent(sound_format) +
						"&client=" + encodeURIComponent(client_info);
	console.log('your TTS URL: ' + url);
	
	//get url
	$.ajax({
		type: "GET",
		url: url,
		timeout: 10000,
		dataType: "jsonp",
		success: function (response) {
			console.log("GET_AUDIO SUCCESS: " + JSON.stringify(response));
			var audioURL = "";
			if (response.result === "success"){
				audioURL = response.url;
				play(audioURL);
			}
		},
		error: function (e) {
			console.log("GET_AUDIO ERROR: " + JSON.stringify(e));
			var audioURL = "";
		}
	});
}
</script>